# Import Strategy Root Cause Analysis

## Discovery Date: 2025-11-07 06:51 UTC

## Problem Statement
Iteration 9 only added +3 resources (747→750) despite planning 1,198 operations. Root cause: **`all_resources` import strategy not implemented**.

## Technical Details

### Current Implementation (src/iac/emitters/terraform_emitter.py:853-858)
```python
elif self.import_strategy == "all_resources":
    # Import all resources (aggressive strategy)
    # TODO: Implement full resource ID construction for all resource types
    logger.warning(
        "all_resources strategy with existence validation not yet implemented"
    )
```

### Impact
- **Current**: Only checks 152 resource groups
- **Needed**: Check ~4,000 individual resources
- **Result**: 313 AlreadyExists errors in iteration 9

## What Works
- `ImportStrategy.RESOURCE_GROUPS` ✅ Fully implemented
- `ImportStrategy.ALL_RESOURCES` ⚠️ Enum exists but logic is TODO
- `ImportStrategy.SELECTIVE` ⚠️ Not implemented

## Implementation Requirements
1. Extend `_generate_import_blocks_with_existence_validation()` to handle ALL resource types
2. Build proper Azure resource IDs for each resource type (not just RGs)
3. Use `ResourceExistenceValidator` to check existence of every planned resource
4. Generate import blocks for all existing resources

## Estimated Complexity
**Medium-High** (2-3 hours careful implementation)
- Need to map each Terraform resource type to Azure resource ID format
- Need to handle all resource types in AZURE_TO_TERRAFORM_MAPPING
- Need comprehensive testing to avoid breaking existing functionality

## Expected Impact
- Eliminate ~90% of AlreadyExists errors (313→~30)
- Increase resource deployment success rate from 6% to ~60%+
- Accelerate faithful replica progress significantly

## Next Steps
1. Implement `all_resources` strategy in terraform_emitter.py
2. Add resource ID construction for all supported types
3. Test with iteration 13+ using `--import-strategy all_resources`
4. Monitor AlreadyExists error reduction

## Current Workaround
Continue with `resource_groups` strategy - progress will be slow but autonomous loop operational.

---
Generated by: Claude Code (Autonomous Faithful Replica Session)
Status: Iteration 11 launched with current strategy
