# File Structure: Upweight Factor Test Implementation

## Complete File Inventory

```
azure-tenant-grapher/
├── src/
│   └── architecture_based_replicator.py      # Target file for modifications
│       ├── Line 2214: return 6.0 * rare_boost_factor  (orphaned boost)
│       ├── Line 2220: return 3.0 * rare_boost_factor  (underrepresented boost)
│       └── Multiple: missing_type_threshold: float = 0.1 (threshold defaults)
│
├── scripts/
│   ├── test_rare_boost_factor.py                # Main implementation (776 lines)
│   │   ├── Layer 1: Safety & State Management
│   │   │   ├── IterationResult dataclass
│   │   │   └── TestSession class
│   │   │       ├── __init__() + __post_init__()
│   │   │       ├── record_iteration()
│   │   │       ├── restore()
│   │   │       ├── save_report()
│   │   │       └── _find_best_strategy()
│   │   │
│   │   ├── Layer 2: Core Testing
│   │   │   ├── test_rare_boost_factor()
│   │   │   └── compute_coverage_difference()
│   │   │
│   │   ├── Layer 3: Improvement Strategies
│   │   │   ├── STRATEGIES list (5 strategies)
│   │   │   ├── apply_strategy()
│   │   │   └── reload_replicator()
│   │   │
│   │   └── Layer 4: Orchestration
│   │       ├── run_improvement_loop()
│   │       └── main()
│   │
│   ├── README_test_rare_boost_factor.md         # Comprehensive documentation (13KB)
│   │   ├── Overview
│   │   ├── Architecture
│   │   ├── Usage (3 CLI modes)
│   │   ├── Improvement Strategies
│   │   ├── How It Works
│   │   ├── Safety Features
│   │   ├── Configuration
│   │   ├── Output (Console + JSON)
│   │   ├── Interpreting Results
│   │   ├── Implementation Notes
│   │   ├── Troubleshooting
│   │   ├── Examples (3 complete scenarios)
│   │   ├── Related Documentation
│   │   └── Future Enhancements
│   │
│   ├── QUICK_START_upweight_test.md           # Quick reference guide (5.3KB)
│   │   ├── TL;DR (quick commands)
│   │   ├── What It Does
│   │   ├── Prerequisites
│   │   ├── Three Usage Modes
│   │   ├── Available Strategies (table)
│   │   ├── Interpreting Results
│   │   ├── Success Outcomes
│   │   ├── Example Usage
│   │   ├── Safety Guarantees
│   │   ├── Common Issues
│   │   ├── Output Files
│   │   ├── Next Steps After Success
│   │   └── Related Documentation
│   │
│   ├── VERIFICATION_CHECKLIST.md              # Implementation verification (10KB)
│   │   ├── Architecture Compliance (Layers 1-4)
│   │   ├── Implementation Details
│   │   ├── Success Criteria
│   │   ├── Code Quality
│   │   ├── File Structure
│   │   ├── Summary
│   │   ├── Manual Testing Checklist
│   │   └── Related Files
│   │
│   └── FILE_STRUCTURE.md                      # This file
│
├── IMPLEMENTATION_SUMMARY_upweight_test.md    # High-level summary (16KB)
│   ├── Overview
│   ├── Deliverables
│   ├── Key Features
│   ├── Architecture Design
│   ├── Design Decisions
│   ├── Implementation Statistics
│   ├── Verification Status
│   ├── Usage Examples
│   ├── Future Enhancements
│   ├── Related Documentation
│   └── Conclusion
│
├── .claude/docs/
│   └── INVESTIGATION_spectral_weight_parameter_effectiveness.md
│       └── (Investigation that led to this implementation)
│
├── SPECTRAL_WEIGHT_INVESTIGATION.md           # Root investigation document
│
└── upweight_test_report.json                  # Generated by full loop mode
    ├── timestamp
    ├── target_file
    ├── iterations[]
    │   ├── strategy_name
    │   ├── coverage_diff
    │   ├── success
    │   ├── error
    │   ├── metrics_1_0
    │   └── metrics_5_0
    └── best_strategy
        ├── strategy_name
        ├── coverage_diff
        └── success
```

## File Purposes

### Implementation

| File                          | Purpose                                     | Size    |
|-------------------------------|---------------------------------------------|---------|
| `test_rare_boost_factor.py`     | Main auto-improving test script             | 776 LOC |
| `architecture_based_replicator.py` | Target file for code modifications     | ~2300 LOC |

### Documentation

| File                                  | Purpose                          | Size    | Audience           |
|---------------------------------------|----------------------------------|---------|--------------------|
| `README_test_rare_boost_factor.md`      | Comprehensive guide              | 13KB    | All users          |
| `QUICK_START_upweight_test.md`        | Quick reference                  | 5.3KB   | Quick start users  |
| `VERIFICATION_CHECKLIST.md`           | Implementation verification      | 10KB    | Developers/QA      |
| `IMPLEMENTATION_SUMMARY_upweight_test.md` | High-level overview          | 16KB    | PMs/Architects     |
| `FILE_STRUCTURE.md`                   | This file (file organization)    | 3KB     | All users          |

### Generated Output

| File                          | Purpose                                     | Format  |
|-------------------------------|---------------------------------------------|---------|
| `upweight_test_report.json`   | Test results and iteration history          | JSON    |
| `*.py.backup`                 | Temporary backup during test (auto-cleaned) | Python  |

## Documentation Reading Order

### For Users (Want to Run the Script)

1. **Start**: `QUICK_START_upweight_test.md` (TL;DR)
2. **Details**: `README_test_rare_boost_factor.md` (if issues or questions)
3. **Troubleshooting**: `README_test_rare_boost_factor.md` → Troubleshooting section

### For Developers (Want to Understand Implementation)

1. **Start**: `IMPLEMENTATION_SUMMARY_upweight_test.md` (overview)
2. **Verify**: `VERIFICATION_CHECKLIST.md` (all features implemented)
3. **Code**: `test_rare_boost_factor.py` (read implementation)
4. **Details**: `README_test_rare_boost_factor.md` → Implementation Notes

### For Architects/PMs (Want High-Level Understanding)

1. **Start**: `IMPLEMENTATION_SUMMARY_upweight_test.md`
2. **Context**: `.claude/docs/INVESTIGATION_spectral_weight_parameter_effectiveness.md`
3. **Quick Ref**: `QUICK_START_upweight_test.md` (see what it does)

## File Relationships

```
Investigation → Architecture Design → Implementation → Documentation
     │                   │                   │               │
     └─> INVESTIGATION_spectral_weight... ─> notebook ─> test_rare_boost_factor.py
                                               │            │
                                               └────────────┴─> README_*.md
                                                                 QUICK_START_*.md
                                                                 VERIFICATION_*.md
                                                                 IMPLEMENTATION_SUMMARY_*.md
```

## CLI Commands → Files

```
# Full improvement loop
python scripts/test_rare_boost_factor.py
  ├─> Reads: src/architecture_based_replicator.py
  ├─> Writes: upweight_test_report.json
  └─> Creates: architecture_based_replicator.py.backup (temporary)

# Dry run mode
python scripts/test_rare_boost_factor.py --dry-run
  ├─> Reads: src/architecture_based_replicator.py
  └─> Never modifies files

# Single strategy test
python scripts/test_rare_boost_factor.py --strategy 0
  ├─> Reads: src/architecture_based_replicator.py
  ├─> Writes: src/architecture_based_replicator.py (modified, then restored)
  └─> Creates: architecture_based_replicator.py.backup (temporary)
```

## Code Modification Targets

### Boost Multipliers (apply_strategy: boost_multipliers)

**Line 2214** (Missing/Orphaned types):
```python
# Before
return 6.0 * rare_boost_factor

# After (boost_8_4 strategy)
return 8.0 * rare_boost_factor
```

**Line 2220** (Underrepresented types):
```python
# Before
return 3.0 * rare_boost_factor

# After (boost_8_4 strategy)
return 4.0 * rare_boost_factor
```

### Threshold (apply_strategy: threshold)

**Multiple locations** (function signatures):
```python
# Before
missing_type_threshold: float = 0.1

# After (threshold_0.05 strategy)
missing_type_threshold: float = 0.05
```

## Data Flow

```
1. User runs script
   └─> python scripts/test_rare_boost_factor.py

2. Script loads configuration
   ├─> Neo4j config from environment variables
   ├─> Test params (hardcoded in main())
   └─> Imports architecture_based_replicator

3. TestSession created
   ├─> Creates backup (.py.backup)
   └─> Stores original content in memory

4. Baseline test (iteration 0)
   ├─> test_rare_boost_factor(1.0)
   │   ├─> Calls replicator.generate_replication_plan()
   │   ├─> Extracts source_nodes, target_nodes
   │   └─> Computes node_coverage
   │
   ├─> test_rare_boost_factor(5.0)
   │   └─> (same as above)
   │
   └─> compute_coverage_difference()
       └─> Returns percentage point difference

5. If coverage_diff < 5%:
   Improvement iterations (1-10)
   ├─> apply_strategy(strategy_N)
   │   ├─> Read file content
   │   ├─> Apply string replacements
   │   ├─> Validate syntax (compile())
   │   └─> Write modified content
   │
   ├─> reload_replicator()
   │   ├─> Remove from sys.modules
   │   └─> Reimport module
   │
   ├─> test_rare_boost_factor(1.0) + test_rare_boost_factor(5.0)
   │   └─> (uses modified code)
   │
   ├─> compute_coverage_difference()
   │   └─> Returns new difference
   │
   ├─> If success (diff >= 5%):
   │   └─> Stop, report success
   │
   └─> Else:
       ├─> session.restore() (original code)
       └─> Try next strategy

6. Generate report
   ├─> session.save_report() → upweight_test_report.json
   └─> Print console summary

7. Cleanup (finally block)
   ├─> session.restore() (always executed)
   └─> Removes .backup file
```

## Success Metrics

### Implementation Completeness

- [x] 4 layers implemented
- [x] 3 CLI modes functional
- [x] 5 strategies defined
- [x] All safety features present
- [x] Complete error handling
- [x] Comprehensive documentation

### Code Quality

- [x] 776 lines of implementation
- [x] 47.6KB of documentation
- [x] 100% docstring coverage (public functions)
- [x] Type hints where helpful
- [x] Logging for all operations
- [x] No print() statements (except final summary)

### Documentation Quality

- [x] 4 documentation files
- [x] Multiple audience levels (users, developers, PMs)
- [x] Clear examples (3 complete scenarios)
- [x] Troubleshooting guides
- [x] Quick start reference
- [x] Implementation verification checklist

## Total Deliverables

- **Implementation Files**: 1
- **Documentation Files**: 4 (README, Quick Start, Verification, Summary) + 1 (File Structure)
- **Total Lines of Code**: 776
- **Total Documentation**: ~47.6KB
- **Generated Output**: 1 (JSON report)
- **Temporary Files**: 1 (backup, auto-cleaned)

---

**Status**: ✅ Implementation complete and documented
**Date**: 2026-01-29
